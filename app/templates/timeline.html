{% extends "base.html" %}

{% block content %}
  <div class="banner" style="background-color: #3e7dd4 !important; text-align:left; padding: 20px;">
    <div class="container">
      <h1 class="title">{{ title }}</h1>
    </div>
  </div>

    <div class="container py-4">
        <div id="posts-container">
            <p>Loading posts...</p>
        </div>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.19.0/js/md5.min.js"></script>
    <script>
        async function loadTimeline() {
            try {
                const res = await fetch("/api/timeline_post");
                const data = await res.json();

                const container = document.getElementById('posts-container');
                container.innerHTML = "";

                if (data.timeline_posts.length === 0) {
                    container.innerHTML = "<p>No posts found.</p>";
                    return;
                }

                data.timeline_posts.forEach(post => {
                    const postDiv = document.createElement('div');
                    postDiv.className = 'post border rounded p-3 mb-4 bg-white shadow-sm';

                    const avatarUrl = `https://www.gravatar.com/avatar/${md5(post.email.trim().toLowerCase())}?d=identicon`;
                    postDiv.innerHTML = `
                        <div class="d-flex align-items-start">
                            <img src="${avatarUrl}" alt="Avatar" class="rounded-circle me-3" width="50" height="50">
                            <div>
                                <h5 class="mb-1">${post.name}</h5>
                                <small class="text-muted">${new Date(post.created_at).toLocaleString()}</small>
                                <p class="mt-2 mb-0">${post.content}</p>
                            </div>
                        </div>
                    `;
                    container.appendChild(postDiv);
                });
            } catch (err) {
                console.error("Failed to load timeline:", err);
                document.getElementById('posts-container').innerHTML = "<p class='text-danger'>Failed to load posts.</p>";
            }
        }

        loadTimeline();
    </script>
{% endblock %}
